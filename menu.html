<!DOCTYPE html>
<html>
 <head>
	 <meta charset="utf-8" />
 	 <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  	 <script src="DB_sql.js"></script>
  	 <script type="text/javascript" src="GamenSeni.js"></script>
    <script src="https://unpkg.com/wanakana"></script>

 </head>
   
 <body>
           <h2>
            みら弁--メニュー--
            <input type="button" value="マイページ"onclick="RoadMypage()">
            <input type="button" value="幹事"onclick="Roadkanzi()">
            <input type="button" value="商品受け取り">
           </h2>


        
           <p id="err">11時30分以降は注文はできません 
            <input type="text" id="search"  maxlength="1">
            <input type="button" value="検索" id="search_btn"><br>
        </p>

            <input id="left_btn" type="button" value="左" >
            <button id="btn" ></button>
            <input id="right_btn" type="button" value="右">
           

            店の詳細
            <table width="70%" order="1">
                <tr><th>店名</th>           <td id="Shop"><!--ここに店名が追加される--></td></tr> 
                <tr><th>住所</th>           <td id="Js"><!--ここに住所が追加される--></td></tr>  
                <tr><th>電話番号</th>       <td id="Nun"><!--ここに電話番号が追加される--></td></tr>  
                <tr><th>営業時間</th>       <td id="Time"><!--ここに営業時間が追加される--></td></tr>   
                <tr><th>定休日</th><td><span id="Mon">月</span><span id="Tue">火</span><span id="Wed">水</span><span id="Thu">木</span><span id="Fri">金</span><span id="Sat">土</span><span id="Sun">日</span><span id="Hol">祝日</span></td></tr>   

            </table>
            
 </body>
 <script>

    let count = 0;

    let name = DB.sql("select * from tm_shop_mng;");

    let furagu = 0;  //検索ボタン押したかのフラグ

    let count_search = 0;  //合致した配列の数

    localStorage.removeItem("Shop_Key");
    localStorage.removeItem("ShopID");


    $("#btn").text(name[0]["ShopName"]);

    $("#Shop").text(name[0]["ShopName"]);
   
    $("#Js").text(name[0]["ShopKen"]+name[0]["ShopShi"]+name[0]["ShopTyo"]+name[0]["ShopBill"]);

    $("#Nun").text(name[0]["TelNum"]);

    $("#Time").text(name[0]["EigyouStart"]+'~'+name[0]["EigyouEnd"]);

    youbi(0);

    $("#left_btn").prop('disabled',true);

//初期表示------------------------------------------------------------------------------------------------------------------------------------------


 
    $("#left_btn").on("click",function(){    //右ボタン押下

        if(furagu == 0){    

                $("#right_btn").prop('disabled',false);
                count--;
                $("#btn").text(name[count]["ShopName"]);
                $("#Shop").text(name[count]["ShopName"]);
                $("#Js").text(name[count]["ShopKen"]+name[count]["ShopShi"]+name[count]["ShopTyo"]+name[count]["ShopBill"]);
                $("#Nun").text(name[count]["TelNum"]);
                $("#Time").text(name[count]["EigyouStart"]+'~'+name[count]["EigyouEnd"]);
                youbi(count);
                if(count == 0){
                    $("#left_btn").prop('disabled',true);
                }
            
        }else{     //検索後

                $("#right_btn").prop('disabled',false);
                count--;
                $("#btn").text(name[hyouji[count]]["ShopName"]);
                $("#Shop").text(name[hyouji[count]]["ShopName"]);
                $("#Js").text(name[hyouji[count]]["ShopKen"]+name[hyouji[count]]["ShopShi"]+name[hyouji[count]]["ShopTyo"]+name[hyouji[count]]["ShopBill"]);
                $("#Nun").text(name[hyouji[count]]["TelNum"]);
                $("#Time").text(name[hyouji[count]]["EigyouStart"]+'~'+name[hyouji[count]]["EigyouEnd"]);
                youbi(hyouji[count]);
                furagu = 1;
                if(count == 0){
                    $("#left_btn").prop('disabled',true);
                }
                
        };

    });  

    $("#right_btn").on("click",function(){

        if(furagu == 0){
        
                $("#left_btn").prop('disabled',false);
                count++;
                $("#btn").text(name[count]["ShopName"]);
                $("#Shop").text(name[count]["ShopName"]);
                $("#Js").text(name[count]["ShopKen"]+name[count]["ShopShi"]+name[count]["ShopTyo"]+name[count]["ShopBill"]);
                $("#Nun").text(name[count]["TelNum"]);
                $("#Time").text(name[count]["EigyouStart"]+'~'+name[count]["EigyouEnd"]);
                youbi(count);
                if(count == name.length-1){
                    $("#right_btn").prop('disabled',true);
                }

        }else{      //検索後

                $("#left_btn").prop('disabled',false);
                count++;
                $("#btn").text(name[hyouji[count]]["ShopName"]);
                $("#Shop").text(name[hyouji[count]]["ShopName"]);
                $("#Js").text(name[hyouji[count]]["ShopKen"]+name[hyouji[count]]["ShopShi"]+name[hyouji[count]]["ShopTyo"]+name[hyouji[count]]["ShopBill"]);
                $("#Nun").text(name[hyouji[count]]["TelNum"]);
                $("#Time").text(name[hyouji[count]]["EigyouStart"]+'~'+name[hyouji[count]]["EigyouEnd"]);
                youbi(hyouji[count]);
                if(hyouji.length-1 == count){
                    $("#right_btn").prop('disabled',true);
                }
        };
    });   



    $("#btn").on("click", function () {

        let Year =  new Date().getFullYear();
        let Month = new Date().getMonth()+ 1;
        let Day = new Date().getDay();
        let Hours = new Date().getHours();
        let Minutes = new Date().getMinutes();
        let Seconds = new Date().getSeconds();

        let simekiri = new Date( Year, Month, Day,18, 30,0 ); // 注文締め切り

        let saikai = new Date(Year, Month, Day,9,0,0); //再開

        let Today = new Date (Year,Month,Day,Hours,Minutes,Seconds);

        if(simekiri < Today ){   //11時３０を過ぎたらボタン押下不可

            $("#btn").prop('disabled',true);
            $("#err").css("color","red");
            
        }else if(saikai < Today ){    //０時０分を過ぎたら再開

            $("#btn").prop('disabled',false);
            RoadShop()
           
            let ShopName = $("#btn").text();
	        
            localStorage.setItem("ShopName",ShopName);

        };
    });


//検索機能--------------------------------------------------------------------------------------------------------------------------------------------

    let Count = name.length;  //データの数

    let hira_name = [Count];

    let hyouji =[name.length];

   

    $("#search_btn").on("click",function(){

        if(!$("#search").val()==""){

            for(i=0;i<name.length;i++){
                let hiragana = wanakana.toHiragana(name[i]["ShopName"]);   //平仮名に変換して変数に入れる

                hira_name[i] = hiragana;  //配列に入れる

                let kensaku = $("#search").val();  //入力した値を持ってくる

                let slice_hira = hira_name[i].slice(0,1);   //配列ごとに前から1文字だけを残し変数に入れる

                if(kensaku==slice_hira){
   
                    hyouji[count_search] = i; //合致したら配列にDBのデータが何番目にあるかを格納
                    console.log(hyouji[count_search])
                    count_search++;
                    
                    
                };
            };

            $("#btn").text(name[hyouji[0]]["ShopName"]);
            $("#Shop").text(name[hyouji[0]]["ShopName"]);
            $("#Js").text(name[hyouji[0]]["ShopKen"]+name[hyouji[0]]["ShopShi"]+name[hyouji[0]]["ShopTyo"]+name[hyouji[0]]["ShopBill"]);
            $("#Nun").text(name[hyouji[0]]["TelNum"]);
            $("#Time").text(name[hyouji[0]]["EigyouStart"]+'~'+name[hyouji[0]]["EigyouEnd"]);
            youbi(hyouji[0]);
            furagu = 1;
            count = 0;
            $("#left_btn").prop('disabled',false);

        }else{

            $("#btn").text(name[0]["ShopName"]);
            $("#Shop").text(name[0]["ShopName"]);
            $("#Js").text(name[0]["ShopKen"]+name[0]["ShopShi"]+name[0]["ShopTyo"]+name[0]["ShopBill"]);
            $("#Nun").text(name[0]["TelNum"]);
            $("#Time").text(name[0]["EigyouStart"]+'~'+name[0]["EigyouEnd"]);
            youbi(0);
            furagu = 0;
            count = 0;
            $("#right_btn").prop('disabled',false);
        };
    });

    
//-----------------------------------------商品受け取り処理------------------------------------------------------

    let userID = localStorage.getItem("ID_Key")

    console.log(userID)

    //let get = DB.sql('call Receive('+userID+')');

    //console.log(get)

    //let user = DB.sql("select * from tm_")

    //for(a=0;a<get.length;++a){

        //if(get[a][""]){}
    //}

   // if(get[""]["pickFlg"]== 0);




//-------------------------------------------------ここからfunction--------------------------------------------------

        function  youbi(count){
        
            $("#Mon").show();
            $("#Tue").show();
            $("#Wed").show();
            $("#Thu").show();
            $("#Fri").show();
            $("#Sat").show();
            $("#Sun").show();
            $("#Hol").show();

        if(name[count]["Mon"] == 0){
            $("#Mon").hide();
        }

        if(name[count]["Tue"] == 0){
            $("#Tue").hide();
        }

        if(name[count]["Wed"] == 0){
            $("#Wed").hide();
        }

        if(name[count]["Thu"] == 0){
            $("#Thu").hide();
        }

        if(name[count]["Fri"] == 0){
            $("#Fri").hide();
        }

        if(name[count]["Sat"] == 0){
            $("#Sat").hide();
        }

        if(name[count]["Sun"] == 0){
            $("#Sun").hide();
        }

        if(name[count]["Hol"] == 0){
            $("#Hol").hide();
        }  
    
    }

     //for(a = 0 ; a < name.length; a++){
       // $("#btn").append('<button id="shop_btn'+a+'" class="shop_btn" onclick="RoadShop()">'+name[a]["ShopName"]+'</button>');    //店ボタンの生成

       // if(name[a]["ShopName"] == null){
            //$("#btn").append('<div id="nasi">'+'これ以上はありません'+'</div>');
       // }

       // if(a!=0){
          //  $("#shop_btn"+a).hide();
        //}
   // }
    
  // for(b = 0 ; b < name.length; b++){
        //$("#Shop").append('<td id="Shop_N'+b+'" class="syousai">'+ name[b]["ShopName"]+'</td>');    //テーブル内の店名生成
        //if(b!=0){
           // $("#Shop_N"+b).hide();
        //}
   // }

   //for(c = 0 ; c < name.length; c++){
       // $("#Js").append('<td id="Shop_Js'+c+'" class="syousai">'+ name[c]["ShopKen"]+name[c]["ShopShi"]+name[c]["ShopTyo"]+name[c]["ShopBill"]+'</td>');  //テーブル内の住所生成
        //if(c!=0){
           // $("#Shop_Js"+c).hide();
        //}
    //}

   // for(d = 0 ; d < name.length; d++){
       // $("#Nun").append('<td id="Shop_Nun'+d+'" class="syousai">'+ name[d]["TelNum"]+'</td>');   //テーブル内の電話番号生成
        //if(d!=0){
           // $("#Shop_Nun"+d).hide();
        //}
   // }

   
  // for(e = 0 ; e < name.length; e++){
        //$("#Time").append('<td id="Shop_Time'+e+'" class="syousai">'+ name[e]["EigyouStart"]+'~'+name[e]["EigyouEnd"]+'</td>');  //テーブル内の営業時間
        //if(e!=0){
           // $("#Shop_Time"+e).hide();
        //}
   // }
 </script>
</html>